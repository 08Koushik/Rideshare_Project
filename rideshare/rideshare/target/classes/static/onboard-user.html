<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Onboard User - RideShare</title>
  <link rel="stylesheet" href="css/style.css">
</head>
<body>
<div class="form-container">
  <h2>Onboard New User</h2>
  <form id="onboardForm">
    <label for="name">Name</label>
    <input type="text" id="name" name="name" required>

    <label for="email">Email</label>
    <input type="email" id="email" name="email" required>

    <label for="contact">Phone Number</label>
    <input type="text" id="contact" name="contact" required>

    <label for="role">Role</label>
    <select id="role" name="role" required>
      <option value="">Select Role</option>
      <option value="DRIVER">Driver</option>
      <option value="PASSENGER">Passenger</option>
    </select>

    <div id="vehicleDiv" style="display: none;">
      <label for="vehicle">Vehicle</label>
      <input type="text" id="vehicle" name="vehicle">
    </div>

    <button type="submit">Add User</button>
  </form>
</div>

<script>
  const roleSelect = document.getElementById("role");
  const vehicleDiv = document.getElementById("vehicleDiv");

  // Show vehicle field only if role is DRIVER
  roleSelect.addEventListener("change", () => {
      if (roleSelect.value === "DRIVER") {
          vehicleDiv.style.display = "block";
      } else {
          vehicleDiv.style.display = "none";
      }
  });

  // Handle form submission
  document.getElementById("onboardForm").addEventListener("submit", function(e) {
      e.preventDefault();

      // *** CRITICAL FIX: Ensure ALL variables are correctly retrieved using .value ***
      // We must explicitly read the .value property of the HTML elements.
      const name = document.getElementById("name").value;
      const email = document.getElementById("email").value;
      const contact = document.getElementById("contact").value;
      const role = document.getElementById("role").value;
      const vehicle = document.getElementById("vehicle").value;
      // ****************************************************************************

      // Check if email is empty (simple validation against sending [object HTMLInputElement])
      if (!email || !name) {
          alert("Please fill in Name and Email.");
          return;
      }

      // Construct the URL with correctly encoded String values
      const fetchUrl = "http://localhost:8080/api/auth/admin/onboard?name=" + encodeURIComponent(name) +
          "&email=" + encodeURIComponent(email) +
          "&contact=" + encodeURIComponent(contact) +
          "&role=" + encodeURIComponent(role) +
          "&vehicle=" + encodeURIComponent(vehicle);

      fetch(fetchUrl, {
              method: "POST"
          })
          .then(response => response.json())
          .then(data => {

              const tempPassword = data.password;

              // Use the locally known 'name' variable for the alert
              alert("User '" + name + "' added successfully!\n\n" +
<!--                    "Temporary Password: " + tempPassword + "\n\n" +-->
                    "âœ… The temporary password has been emailed to the user.\n" +
                    "Please inform the user to log in and reset their password immediately.");

              window.location.href = "admin-dashboard.html";
          })
          .catch(error => {
              console.error("Error:", error);
              alert("Error adding user. Check console for details, and ensure your backend is running and email config is correct.");
          });
  });
  </script>
<script src="js/common.js"></script>
<script src="js/admin.js"></script>

</body>
</html>